<?php
//Parametros
// $URLWebService = "http://localhost/GePlaDoc/ws/get.php";
$URLWebService = "https://plataformaitavu.tamaulipas.gob.mx/gepladoc/ws/get.php";
$MiToken = "Prueba";
$IdPlantilla = 1;
$NEmpleado= "2809";

//Peticion
$myObj = new stdClass;
$myObj->ApiKey = $MiToken;
$myObj->IdPlantilla = $IdPlantilla;
$myObj->NEmpleado = $NEmpleado;

//Variables
$myObj->VC001 = "";
$myObj->VC002 = "";
$myObj->VC003 = "";
$myObj->VC004 = "";
$myObj->VC005 = "";
$myObj->VC006 = "";
$myObj->VC007 = "";
$myObj->VC008 = "";
$myObj->VC009 = "";
$myObj->VC010 = "";
$myObj->VC011 = "";
$myObj->VC012 = "";
$myObj->VC013 = "";
$myObj->VC014 = "";
$myObj->VC015 = "";
$myObj->VC016 = "";
$myObj->VC017 = "";
$myObj->VC018 = "";
$myObj->VC019 = "";
$myObj->VC020 = "";
$myObj->VC021 = "";
$myObj->VC022 = "";
$myObj->VC023 = "";
$myObj->VC024 = "";
$myObj->VC025 = "";
$myObj->VC026 = "";
$myObj->VC027 = "";
$myObj->VC028 = "";
$myObj->VC029 = "";
$myObj->VC030 = "";
$myObj->VC031 = "";
$myObj->VC032 = "";
$myObj->VC033 = "";
$myObj->VC034 = "";
$myObj->VC035 = "";
$myObj->VC036 = "";
$myObj->VC037 = "";
$myObj->VC038 = "";
$myObj->VC039 = "";
$myObj->VC040 = "";
$myObj->VC041 = "";
$myObj->VC042 = "";
$myObj->VC043 = "";
$myObj->VC044 = "";
$myObj->VC045 = "";
$myObj->VC046 = "";
$myObj->VC047 = "";
$myObj->VC048 = "";
$myObj->VC049 = "";
$myObj->VC050 = "";
$myObj->VC051 = "";
$myObj->VC052 = "";
$myObj->VC053 = "";
$myObj->VC054 = "";
$myObj->VC055 = "";
$myObj->VC056 = "";
$myObj->VC057 = "";
$myObj->VC058 = "";
$myObj->VC059 = "";
$myObj->VC060 = "";
$myObj->VC061 = "";
$myObj->VC062 = "";
$myObj->VC063 = "";
$myObj->VC064 = "";
$myObj->VC065 = "";
$myObj->VC066 = "";
$myObj->VC067 = "";
$myObj->VC068 = "";
$myObj->VC069 = "";
$myObj->VC070 = "";
$myObj->VC071 = "";
$myObj->VC072 = "";
$myObj->VC073 = "";
$myObj->VC074 = "";
$myObj->VC075 = "";
$myObj->VC076 = "";
$myObj->VC077 = "";
$myObj->VC078 = "";
$myObj->VC079 = "";
$myObj->VC080 = "";
$myObj->VC081 = "";
$myObj->VC082 = "";
$myObj->VC083 = "";
$myObj->VC084 = "";
$myObj->VC085 = "";
$myObj->VC086 = "";
$myObj->VC087 = "";
$myObj->VC088 = "";
$myObj->VC089 = "";
$myObj->VC090 = "";
$myObj->VC091 = "";
$myObj->VC092 = "";
$myObj->VC093 = "";
$myObj->VC094 = "";
$myObj->VC095 = "";
$myObj->VC096 = "";
$myObj->VC097 = "";
$myObj->VC098 = "";
$myObj->VC099 = "";
$myObj->VC100 = "";
$myObj->VC101 = "";
$myObj->VC102 = "";
$myObj->VC103 = "";
$myObj->VC104 = "";
$myObj->VC105 = "";
$myObj->VC106 = "";
$myObj->VC107 = "";
$myObj->VC108 = "";
$myObj->VC109 = "";
$myObj->VC110 = "";
$myObj->VC111 = "";
$myObj->VC112 = "";
$myObj->VC113 = "";
$myObj->VC114 = "";
$myObj->VC115 = "";
$myObj->VC116 = "";
$myObj->VC117 = "";
$myObj->VC118 = "";
$myObj->VC119 = "";
$myObj->VC120 = "";
$myObj->VC121 = "";
$myObj->VC122 = "";
$myObj->VC123 = "";
$myObj->VC124 = "";
$myObj->VC125 = "";
$myObj->VC126 = "";
$myObj->VC127 = "";
$myObj->VC128 = "";
$myObj->VC129 = "";
$myObj->VC130 = "";
$myObj->VC131 = "";
$myObj->VC132 = "";
$myObj->VC133 = "";
$myObj->VC134 = "";
$myObj->VC135 = "";
$myObj->VC136 = "";
$myObj->VC137 = "";
$myObj->VC138 = "";
$myObj->VC139 = "";
$myObj->VC140 = "";
$myObj->VC141 = "";
$myObj->VC142 = "";
$myObj->VC143 = "";
$myObj->VC144 = "";
$myObj->VC145 = "";
$myObj->VC146 = "";
$myObj->VC147 = "";
$myObj->VC148 = "";
$myObj->VC149 = "";
$myObj->VC150 = "";
$myObj->VC151 = "";
$myObj->VC152 = "";
$myObj->VC153 = "";
$myObj->VC154 = "";
$myObj->VC155 = "";
$myObj->VC156 = "";
$myObj->VC157 = "";
$myObj->VC158 = "";
$myObj->VC159 = "";
$myObj->VC160 = "";
$myObj->VC161 = "";
$myObj->VC162 = "";
$myObj->VC163 = "";
$myObj->VC164 = "";
$myObj->VC165 = "";
$myObj->VC166 = "";
$myObj->VC167 = "";
$myObj->VC168 = "";
$myObj->VC169 = "";
$myObj->VC170 = "";
$myObj->VC171 = "";
$myObj->VC172 = "";
$myObj->VC173 = "";
$myObj->VC174 = "";
$myObj->VC175 = "";
$myObj->VC176 = "";
$myObj->VC177 = "";
$myObj->VC178 = "";
$myObj->VC179 = "";
$myObj->VC180 = "";

//Armar peticion
$myJSON = json_encode($myObj,JSON_UNESCAPED_SLASHES);
        
$datos_post = http_build_query(
    $myObj
);

$opciones = array('http' =>
    array(
        'method'  => 'POST',
        'header'  => 'Content-type: application/x-www-form-urlencoded',
        'content' => $datos_post
    )
);
var_dump($opciones)  ; //<-- peticion
$context = stream_context_create($opciones);          

$archivo_web = file_get_contents($URLWebService, false, $context);            
$data = json_decode($archivo_web);

var_dump($archivo_web); //<-- respuesta



$jsonIterator = new RecursiveIteratorIterator(
    new RecursiveArrayIterator(json_decode($archivo_web, TRUE)),
    RecursiveIteratorIterator::SELF_FIRST
);

$IframeSRC = "";
$Respuesta = "";
$Exito = "";
$urlFile ="";

foreach ($jsonIterator as $key => $val) {
    if (is_numeric($key)){ //rows
    
    }
    else {
        if ($key =='exito'){
            $Exito = $val;

        }

        if ($key =='embed'){
            $IframeSRC = $val;
        }

        if ($key =='msg'){
            $Respuesta = $val;
        }

        if ($key =='urlfile'){
            $urlFile = $val;
        }
    }
    
}


if ($Exito == TRUE){
    echo "
    <iframe src='".$IframeSRC."' frameborder='0' style='width:50%; height:50%;'>Cargando...
    </iframe>";

} else {
    echo '
    <div class="alert alert-danger" role="alert">
    Error al obtener resultados: '.$Respuesta.'
    </div>';
}

?>